<div class="flex flex-col lg:flex-row gap-6">
    <!-- Columna izquierda - Características -->
    <div class="w-full lg:w-2/5 xl:w-5/12">
        <!-- Tarjeta de Características -->
        <div class="card bg-base-200 shadow-xl mb-6 relative overflow-visible">
            <button class="btn btn-ghost btn-circle btn-sm absolute -right-2 -top-2 z-10 bg-secondary shadow-md hover:bg-secondary" onclick="edit_character_modal.showModal()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
            </button>
            <div class="card-body p-4">
                <h2 class="card-title text-xl mb-4">Características</h2>

                <div class="grid grid-cols-3 gap-4">
                    <!-- FUE -->
                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                        <div class="stat-title text-xs">FUE</div>
                        <div class="stat-value text-2xl">{{ character.ability_scores.get('strength', 0) }}</div>
                        <div class="flex justify-center w-full">
                            <div class="badge badge-accent mt-1">
                                {% set strength_mod = character.ability_modifiers.get('strength', 0) %}
                                {{ "%+d"|format(strength_mod) }}
                            </div>
                        </div>
                    </div>

                    <!-- DES -->
                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                        <div class="stat-title text-xs">DES</div>
                        <div class="stat-value text-2xl">{{ character.ability_scores.get('dexterity', 0) }}</div>
                        <div class="flex justify-center w-full">
                            <div class="badge badge-accent mt-1">
                                {% set dexterity_mod = character.ability_modifiers.get('dexterity', 0) %}
                                {{ "%+d"|format(dexterity_mod) }}
                            </div>
                        </div>
                    </div>

                    <!-- CON -->
                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                        <div class="stat-title text-xs">CON</div>
                        <div class="stat-value text-2xl">{{ character.ability_scores.get('constitution', 0) }}</div>
                        <div class="flex justify-center w-full">
                            <div class="badge badge-accent mt-1">
                                {% set constitution_mod = character.ability_modifiers.get('constitution', 0) %}
                                {{ "%+d"|format(constitution_mod) }}
                            </div>
                        </div>
                    </div>

                    <!-- INT -->
                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                        <div class="stat-title text-xs">INT</div>
                        <div class="stat-value text-2xl">{{ character.ability_scores.get('intelligence', 0) }}</div>
                        <div class="flex justify-center w-full">
                            <div class="badge badge-accent mt-1">
                                {% set intelligence_mod = character.ability_modifiers.get('intelligence', 0) %}
                                {{ "%+d"|format(intelligence_mod) }}
                            </div>
                        </div>
                    </div>

                    <!-- SAB -->
                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                        <div class="stat-title text-xs">SAB</div>
                        <div class="stat-value text-2xl">{{ character.ability_scores.get('wisdom', 0) }}</div>
                        <div class="flex justify-center w-full">
                            <div class="badge badge-accent mt-1">
                                {% set wisdom_mod = character.ability_modifiers.get('wisdom', 0) %}
                                {{ "%+d"|format(wisdom_mod) }}
                            </div>
                        </div>
                    </div>

                    <!-- CAR -->
                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                        <div class="stat-title text-xs">CAR</div>
                        <div class="stat-value text-2xl">{{ character.ability_scores.get('charisma', 0) }}</div>
                        <div class="flex justify-center w-full">
                            <div class="badge badge-accent mt-1">
                                {% set charisma_mod = character.ability_modifiers.get('charisma', 0) %}
                                {{ "%+d"|format(charisma_mod) }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stats adicionales -->
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mt-4">
                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                        <div class="stat-title text-xs">Iniciativa</div>
                        <div class="stat-value text-xl">{{ "%+d"|format(dexterity_mod) }}</div>
                    </div>

                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                        <div class="stat-title text-xs">Velocidad</div>
                        <div class="stat-value text-xl">{{ character.speed|default(42) }}</div>
                        <div class="text-xs">pies</div>
                    </div>

                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                        <div class="stat-title text-xs">Clase de</div>
                        <div class="stat-value text-xl">{{ character.armor_class|default(42) }}</div>
                        <div class="stat-title text-xs">armadura</div>
                    </div>

                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                        <div class="stat-title text-xs">Bonif. de</div>
                        <div class="stat-value text-xl">
                            {% set level = character.level|default(1) %}
                            {% set proficiency_bonus = ((level - 1) // 4) + 2 %}
                            +{{ proficiency_bonus }}
                        </div>
                        <div class="stat-title text-xs">competencia</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tiradas de Salvación -->
        <div class="card bg-base-200 shadow-xl mb-6 relative overflow-visible">
            <button class="btn btn-ghost btn-circle btn-sm absolute -right-2 -top-2 z-10 bg-secondary shadow-md hover:bg-secondary" onclick="edit_character_modal.showModal()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
            </button>
            <div class="card-body p-4">
                <h2 class="card-title text-xl mb-4">Tiradas de Salvación</h2>

                <div class="overflow-x-auto">
                    <table class="table table-zebra w-full">
                        <tbody>

                        <tr>
                            <td class="text-center">Competencia</td>
                        </tr>

                        <!-- Fuerza -->
                        <tr>
                            <td class="text-center">
                                {% set strength_proficiency= character.proficiencies.get('strength', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if strength_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if strength_proficiency == 'proficiency' or strength_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Fuerza (Fue)</td>
                            {% set save_strength = strength_mod %}
                            {% if strength_proficiency == 'proficiency' %}
                                {% set save_strength = strength_mod + proficiency_bonus %}
                            {% elif strength_proficiency == 'expertise' %}
                                {% set save_strength = strength_mod + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(save_strength) }}</td>
                        </tr>

                        <!-- Destreza -->
                        <tr>
                            <td class="text-center">
                                {% set dexterity_proficiency= character.proficiencies.get('dexterity', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if dexterity_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if dexterity_proficiency == 'proficiency' or dexterity_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Destreza (Des)</td>
                            {% set save_dexterity = dexterity_mod %}
                            {% if dexterity_proficiency == 'proficiency' %}
                                {% set save_dexterity = dexterity_mod + proficiency_bonus %}
                            {% elif dexterity_proficiency == 'expertise' %}
                                {% set save_dexterity = dexterity_mod + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(save_dexterity) }}</td>
                        </tr>

                        <!-- Constitución -->
                        <tr>
                            <td class="text-center">
                                {% set constitution_proficiency= character.proficiencies.get('constitution', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if constitution_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if constitution_proficiency == 'proficiency' or constitution_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Constitución (Con)</td>
                            {% set save_constitution = constitution_mod %}
                            {% if constitution_proficiency == 'proficiency' %}
                                {% set save_constitution = constitution_mod + proficiency_bonus %}
                            {% elif constitution_proficiency == 'expertise' %}
                                {% set save_constitution = constitution_mod + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(save_constitution) }}</td>
                        </tr>

                        <!-- Inteligencia -->
                        <tr>
                            <td class="text-center">
                                {% set intelligence_proficiency= character.proficiencies.get('intelligence', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if intelligence_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if intelligence_proficiency == 'proficiency' or intelligence_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Inteligencia (Int)</td>
                            {% set save_intelligence = intelligence_mod %}
                            {% if intelligence_proficiency == 'proficiency' %}
                                {% set save_intelligence = intelligence_mod + proficiency_bonus %}
                            {% elif intelligence_proficiency == 'expertise' %}
                                {% set save_intelligence = intelligence_mod + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(save_intelligence) }}</td>
                        </tr>

                        <!-- Sabiduría -->
                        <tr>
                            <td class="text-center">
                                {% set wisdom_proficiency= character.proficiencies.get('wisdom', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if wisdom_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if wisdom_proficiency == 'proficiency' or wisdom_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Sabiduría (Sab)</td>
                            {% set save_wisdom = wisdom_mod %}
                            {% if wisdom_proficiency == 'proficiency' %}
                                {% set save_wisdom = wisdom_mod + proficiency_bonus %}
                            {% elif wisdom_proficiency == 'expertise' %}
                                {% set save_wisdom = wisdom_mod + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(save_wisdom) }}</td>
                        </tr>

                        <!-- Carisma -->
                        <tr>
                            <td class="text-center">
                                {% set charisma_proficiency= character.proficiencies.get('charisma', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if charisma_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if charisma_proficiency == 'proficiency' or charisma_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Carisma (Car)</td>
                            {% set save_charisma = charisma_mod %}
                            {% if charisma_proficiency == 'proficiency' %}
                                {% set save_charisma = charisma_mod + proficiency_bonus %}
                            {% elif charisma_proficiency == 'expertise' %}
                                {% set save_charisma = charisma_mod + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(save_charisma) }}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Columna derecha - Habilidades -->
    <div class="w-full lg:w-3/5 xl:w-7/12">
        <div class="card bg-base-200 shadow-xl mb-6 relative overflow-visible">
            <button class="btn btn-ghost btn-circle btn-sm absolute -right-2 -top-2 z-10 bg-secondary shadow-md hover:bg-secondary" onclick="edit_character_modal.showModal()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
            </button>
            <div class="card-body p-4">
                <h2 class="card-title text-xl mb-4">Habilidades</h2>

                <div class="overflow-x-auto">
                    <table class="table table-zebra w-full">
                        <tbody>

                        <tr>
                            <td class="text-center">Competencia</td>
                        </tr>

                        <!-- Acrobacias -->
                        <tr>
                            <td class="text-center">
                                {% set acrobatics_proficiency= character.proficiencies.get('acrobatics', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if acrobatics_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if acrobatics_proficiency == 'proficiency' or acrobatics_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Acrobacias (Des)</td>
                            {% set skill_acrobatics = dexterity_mod %}
                            {% if acrobatics_proficiency == 'proficiency' %}
                                {% set skill_acrobatics = skill_acrobatics + proficiency_bonus %}
                            {% elif acrobatics_proficiency == 'expertise' %}
                                {% set skill_acrobatics = skill_acrobatics + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_acrobatics) }}</td>
                        </tr>

                        <!-- Arcanos -->
                        <tr>
                            <td class="text-center">
                                {% set arcana_proficiency= character.proficiencies.get('arcana', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if arcana_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if arcana_proficiency == 'proficiency' or arcana_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Arcanos (Int)</td>
                            {% set skill_arcana = intelligence_mod %}
                            {% if arcana_proficiency == 'proficiency' %}
                                {% set skill_arcana = skill_arcana + proficiency_bonus %}
                            {% elif arcana_proficiency == 'expertise' %}
                                {% set skill_arcana = skill_arcana + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_arcana) }}</td>
                        </tr>

                        <!-- Atletismo -->
                        <tr>
                            <td class="text-center">
                                {% set athletics_proficiency= character.proficiencies.get('athletics', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if athletics_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if athletics_proficiency == 'proficiency' or athletics_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Atletismo (Fue)</td>
                            {% set skill_athletics = strength_mod %}
                            {% if athletics_proficiency == 'proficiency' %}
                                {% set skill_athletics = skill_athletics + proficiency_bonus %}
                            {% elif athletics_proficiency == 'expertise' %}
                                {% set skill_athletics = skill_athletics + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_athletics) }}</td>
                        </tr>

                        <!-- Engañar -->
                        <tr>
                            <td class="text-center">
                                {% set deception_proficiency= character.proficiencies.get('deception', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if deception_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if deception_proficiency == 'proficiency' or deception_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Engañar (Car)</td>
                            {% set skill_deception = charisma_mod %}
                            {% if deception_proficiency == 'proficiency' %}
                                {% set skill_deception = skill_deception + proficiency_bonus %}
                            {% elif deception_proficiency == 'expertise' %}
                                {% set skill_deception = skill_deception + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_deception) }}</td>
                        </tr>

                        <!-- Historia -->
                        <tr>
                            <td class="text-center">
                                {% set history_proficiency= character.proficiencies.get('history', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if history_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if history_proficiency == 'proficiency' or history_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Historia (Int)</td>
                            {% set skill_history = intelligence_mod %}
                            {% if history_proficiency == 'proficiency' %}
                                {% set skill_history = skill_history + proficiency_bonus %}
                            {% elif history_proficiency == 'expertise' %}
                                {% set skill_history = skill_history + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_history) }}</td>
                        </tr>

                        <!-- Interpretación -->
                        <tr>
                            <td class="text-center">
                                {% set performance_proficiency= character.proficiencies.get('performance', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if performance_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if performance_proficiency == 'proficiency' or performance_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Interpretación (Car)</td>
                            {% set skill_performance = charisma_mod %}
                            {% if performance_proficiency == 'proficiency' %}
                                {% set skill_performance = skill_performance + proficiency_bonus %}
                            {% elif performance_proficiency == 'expertise' %}
                                {% set skill_performance = skill_performance + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_performance) }}</td>
                        </tr>

                        <!-- Intimidar -->
                        <tr>
                            <td class="text-center">
                                {% set intimidation_proficiency= character.proficiencies.get('intimidation', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if intimidation_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if intimidation_proficiency == 'proficiency' or intimidation_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Intimidar (Car)</td>
                            {% set skill_intimidation = charisma_mod %}
                            {% if intimidation_proficiency == 'proficiency' %}
                                {% set skill_intimidation = skill_intimidation + proficiency_bonus %}
                            {% elif intimidation_proficiency == 'expertise' %}
                                {% set skill_intimidation = skill_intimidation + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_intimidation) }}</td>
                        </tr>

                        <!-- Investigación -->
                        <tr>
                            <td class="text-center">
                                {% set investigation_proficiency= character.proficiencies.get('investigation', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if investigation_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if investigation_proficiency == 'proficiency' or investigation_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Investigación (Int)</td>
                            {% set skill_investigation = intelligence_mod %}
                            {% if investigation_proficiency == 'proficiency' %}
                                {% set skill_investigation = skill_investigation + proficiency_bonus %}
                            {% elif investigation_proficiency == 'expertise' %}
                                {% set skill_investigation = skill_investigation + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_investigation) }}</td>
                        </tr>

                        <!-- Juego de Manos -->
                        <tr>
                            <td class="text-center">
                                {% set sleight_of_hand_proficiency= character.proficiencies.get('sleight_of_hand', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if sleight_of_hand_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if sleight_of_hand_proficiency == 'proficiency' or sleight_of_hand_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Juego de Manos (Des)</td>
                            {% set skill_sleight_of_hand = dexterity_mod %}
                            {% if sleight_of_hand_proficiency == 'proficiency' %}
                                {% set skill_sleight_of_hand = skill_sleight_of_hand + proficiency_bonus %}
                            {% elif sleight_of_hand_proficiency == 'expertise' %}
                                {% set skill_sleight_of_hand = skill_sleight_of_hand + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_sleight_of_hand) }}</td>
                        </tr>

                        <!-- Medicina -->
                        <tr>
                            <td class="text-center">
                                {% set medicine_proficiency= character.proficiencies.get('medicine', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if medicine_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if medicine_proficiency == 'proficiency' or medicine_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Medicina (Sab)</td>
                            {% set skill_medicine = wisdom_mod %}
                            {% if medicine_proficiency == 'proficiency' %}
                                {% set skill_medicine = skill_medicine + proficiency_bonus %}
                            {% elif medicine_proficiency == 'expertise' %}
                                {% set skill_medicine = skill_medicine + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_medicine) }}</td>
                        </tr>

                        <!-- Naturaleza -->
                        <tr>
                            <td class="text-center">
                                {% set nature_proficiency= character.proficiencies.get('nature', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if nature_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if nature_proficiency == 'proficiency' or nature_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Naturaleza (Int)</td>
                            {% set skill_nature = intelligence_mod %}
                            {% if nature_proficiency == 'proficiency' %}
                                {% set skill_nature = skill_nature + proficiency_bonus %}
                            {% elif nature_proficiency == 'expertise' %}
                                {% set skill_nature = skill_nature + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_nature) }}</td>
                        </tr>

                        <!-- Percepción -->
                        <tr>
                            <td class="text-center">
                                {% set perception_proficiency= character.proficiencies.get('perception', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if perception_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if perception_proficiency == 'proficiency' or perception_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Percepción (Sab)</td>
                            {% set skill_perception = wisdom_mod %}
                            {% if perception_proficiency == 'proficiency' %}
                                {% set skill_perception = skill_perception + proficiency_bonus %}
                            {% elif perception_proficiency == 'expertise' %}
                                {% set skill_perception = skill_perception + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_perception) }}</td>
                        </tr>

                        <!-- Perspicacia -->
                        <tr>
                            <td class="text-center">
                                {% set insight_proficiency= character.proficiencies.get('insight', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if insight_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if insight_proficiency == 'proficiency' or insight_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Perspicacia (Sab)</td>
                            {% set skill_insight = wisdom_mod %}
                            {% if insight_proficiency == 'proficiency' %}
                                {% set skill_insight = skill_insight + proficiency_bonus %}
                            {% elif insight_proficiency == 'expertise' %}
                                {% set skill_insight = skill_insight + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_insight) }}</td>
                        </tr>

                        <!-- Persuasión -->
                        <tr>
                            <td class="text-center">
                                {% set persuasion_proficiency= character.proficiencies.get('persuasion', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if persuasion_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if persuasion_proficiency == 'proficiency' or persuasion_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Persuasión (Car)</td>
                            {% set skill_persuasion = charisma_mod %}
                            {% if persuasion_proficiency == 'proficiency' %}
                                {% set skill_persuasion = skill_persuasion + proficiency_bonus %}
                            {% elif persuasion_proficiency == 'expertise' %}
                                {% set skill_persuasion = skill_persuasion + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_persuasion) }}</td>
                        </tr>

                        <!-- Religión -->
                        <tr>
                            <td class="text-center">
                                {% set religion_proficiency= character.proficiencies.get('religion', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if religion_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if religion_proficiency == 'proficiency' or religion_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Religión (Int)</td>
                            {% set skill_religion = intelligence_mod %}
                            {% if character.proficiencies.get('religion', None) == 'proficiency' %}
                                {% set skill_religion = skill_religion + proficiency_bonus %}
                            {% elif character.proficiencies.get('religion', None) == 'expertise' %}
                                {% set skill_religion = skill_religion + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_religion) }}</td>
                        </tr>

                        <!-- Sigilo -->
                        <tr>
                            <td class="text-center">
                                {% set stealth_proficiency= character.proficiencies.get('stealth', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if stealth_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if stealth_proficiency == 'proficiency' or stealth_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Sigilo (Des)</td>
                            {% set skill_stealth = dexterity_mod %}
                            {% if stealth_proficiency == 'proficiency' %}
                                {% set skill_stealth = skill_stealth + proficiency_bonus %}
                            {% elif stealth_proficiency == 'expertise' %}
                                {% set skill_stealth = skill_stealth + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_stealth) }}</td>
                        </tr>

                        <!-- Supervivencia -->
                        <tr>
                            <td class="text-center">
                                {% set survival_proficiency= character.proficiencies.get('survival', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if survival_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if survival_proficiency == 'proficiency' or survival_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Supervivencia (Sab)</td>
                            {% set skill_survival = wisdom_mod %}
                            {% if survival_proficiency == 'proficiency' %}
                                {% set skill_survival = skill_survival + proficiency_bonus %}
                            {% elif survival_proficiency == 'expertise' %}
                                {% set skill_survival = skill_survival + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_survival) }}</td>
                        </tr>

                        <!-- Trato con Animales -->
                        <tr>
                            <td class="text-center">
                                {% set animal_handling_proficiency= character.proficiencies.get('animal_handling', None) %}
                                <input type="checkbox" class="checkbox checkbox-sm {% if animal_handling_proficiency == 'expertise' %}checkbox-accent{% endif %}"
                                       onclick="addProficiencyBonus(this)"
                                       {% if animal_handling_proficiency == 'proficiency' or animal_handling_proficiency == 'expertise' %}checked="checked"{% endif %}/>
                            </td>
                            <td>Trato con Animales (Sab)</td>
                            {% set skill_animal_handling = wisdom_mod %}
                            {% if animal_handling_proficiency == 'proficiency' %}
                                {% set skill_animal_handling = skill_animal_handling + proficiency_bonus %}
                            {% elif animal_handling_proficiency == 'expertise' %}
                                {% set skill_animal_handling = skill_animal_handling + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_animal_handling) }}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Otras Competencias -->
        <div class="card bg-base-200 shadow-xl mb-6 hidden relative overflow-visible">
            <button class="btn btn-ghost btn-circle btn-sm absolute -right-2 -top-2 z-10 bg-secondary shadow-md hover:bg-secondary" onclick="edit_character_modal.showModal()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
            </button>
            <div class="card-body p-4">
                <h2 class="card-title text-xl mb-4">Otras Competencias</h2>

                <div class="mb-4">
                    <p class="font-medium mb-2">Dispones de las siguientes competencias adicionales:</p>
                    <ul class="list-disc list-inside space-y-1 pl-4">
                        <li>Ballesta ligera, Bastón, Daga, Dardo y Honda</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function addProficiencyBonus(checkbox) {
            const proficiency_bonus = parseInt("{{ proficiency_bonus | tojson }}");
            const bonusCell = checkbox.parentElement.nextElementSibling.nextElementSibling;
            const currentValue = parseInt(bonusCell.textContent);
            const originalValue = parseInt(checkbox.dataset.originalValue || currentValue);

            if (checkbox.checked) {
                // Almacena el valor original si no se ha almacenado
                if (!checkbox.dataset.originalValue) {
                    checkbox.dataset.originalValue = currentValue.toString();
                }
                const newValue = originalValue + proficiency_bonus;
                bonusCell.textContent = (newValue >= 0 ? '+' : '') + newValue;
            } else {
                // Restaura el valor original con su signo
                bonusCell.textContent = (originalValue >= 0 ? '+' : '') + originalValue;
            }
        }
    </script>
</div>
<div class="flex flex-col lg:flex-row gap-6">
    <!-- Columna izquierda - Características -->
    <div class="w-full lg:w-2/5 xl:w-5/12">
        <!-- Tarjeta de Características -->
        <div class="card bg-base-200 shadow-xl mb-6 relative overflow-visible">
            <button class="btn btn-ghost btn-circle btn-sm absolute -right-2 -top-2 z-10 bg-secondary shadow-md hover:bg-secondary" onclick="edit_stats_modal.showModal()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
            </button>
            <div class="card-body p-4">
                <h2 class="card-title text-xl mb-4">Características</h2>

                <div class="grid grid-cols-3 gap-4">
                    <!-- FUE -->
                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                        <div class="stat-title text-xs">FUE</div>
                        <div class="stat-value text-2xl">{{ character.ability_scores.get('strength', 0) }}</div>
                        <div class="flex justify-center w-full">
                            <div class="badge badge-accent mt-1">
                                {% set strength_mod = character.ability_modifiers.get('strength', 0) %}
                                {{ "%+d"|format(strength_mod) }}
                            </div>
                        </div>
                    </div>

                    <!-- DES -->
                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                        <div class="stat-title text-xs">DES</div>
                        <div class="stat-value text-2xl">{{ character.ability_scores.get('dexterity', 0) }}</div>
                        <div class="flex justify-center w-full">
                            <div class="badge badge-accent mt-1">
                                {% set dexterity_mod = character.ability_modifiers.get('dexterity', 0) %}
                                {{ "%+d"|format(dexterity_mod) }}
                            </div>
                        </div>
                    </div>

                    <!-- CON -->
                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                        <div class="stat-title text-xs">CON</div>
                        <div class="stat-value text-2xl">{{ character.ability_scores.get('constitution', 0) }}</div>
                        <div class="flex justify-center w-full">
                            <div class="badge badge-accent mt-1">
                                {% set constitution_mod = character.ability_modifiers.get('constitution', 0) %}
                                {{ "%+d"|format(constitution_mod) }}
                            </div>
                        </div>
                    </div>

                    <!-- INT -->
                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                        <div class="stat-title text-xs">INT</div>
                        <div class="stat-value text-2xl">{{ character.ability_scores.get('intelligence', 0) }}</div>
                        <div class="flex justify-center w-full">
                            <div class="badge badge-accent mt-1">
                                {% set intelligence_mod = character.ability_modifiers.get('intelligence', 0) %}
                                {{ "%+d"|format(intelligence_mod) }}
                            </div>
                        </div>
                    </div>

                    <!-- SAB -->
                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                        <div class="stat-title text-xs">SAB</div>
                        <div class="stat-value text-2xl">{{ character.ability_scores.get('wisdom', 0) }}</div>
                        <div class="flex justify-center w-full">
                            <div class="badge badge-accent mt-1">
                                {% set wisdom_mod = character.ability_modifiers.get('wisdom', 0) %}
                                {{ "%+d"|format(wisdom_mod) }}
                            </div>
                        </div>
                    </div>

                    <!-- CAR -->
                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                        <div class="stat-title text-xs">CAR</div>
                        <div class="stat-value text-2xl">{{ character.ability_scores.get('charisma', 0) }}</div>
                        <div class="flex justify-center w-full">
                            <div class="badge badge-accent mt-1">
                                {% set charisma_mod = character.ability_modifiers.get('charisma', 0) %}
                                {{ "%+d"|format(charisma_mod) }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stats adicionales -->
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mt-4">
                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                        <div class="stat-title text-xs">Iniciativa</div>
                        <div class="stat-value text-xl">{{ "%+d"|format(dexterity_mod) }}</div>
                    </div>

                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                        <div class="stat-title text-xs">Velocidad</div>
                        <div class="stat-value text-xl">{{ character.speed }}</div>
                        <div class="text-xs">pies</div>
                    </div>

                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                        <div class="stat-title text-xs">Clase de</div>
                        <div class="stat-value text-xl">{{ character.armor_class }}</div>
                        <div class="stat-title text-xs">armadura</div>
                    </div>

                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                        <div class="stat-title text-xs">Bonif. de</div>
                        <div class="stat-value text-xl">
                            {% set level = character.level|default(1) %}
                            {% set proficiency_bonus = ((level - 1) // 4) + 2 %}
                            +{{ proficiency_bonus }}
                        </div>
                        <div class="stat-title text-xs">competencia</div>
                    </div>
                </div>
            </div>

            {% include 'characters/edit_modals/stats_modal.html' %}
        </div>

        <!-- Tiradas de Salvación -->
        <div class="card bg-base-200 shadow-xl mb-6 relative overflow-visible">
            <button class="btn btn-ghost btn-circle btn-sm absolute -right-2 -top-2 z-10 bg-secondary shadow-md hover:bg-secondary" onclick="edit_saving_throws_modal.showModal()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
            </button>
            <div class="card-body p-4">
                <h2 class="card-title text-xl mb-4">Tiradas de Salvación</h2>

                <div class="overflow-x-auto">
                    <table class="table table-zebra w-full">
                        <tbody>

                        <tr>
                            <td class="text-center">Competencia</td>
                        </tr>

                        <!-- Fuerza -->
                        <tr>
                            <td class="text-center">
                                {% set strength_proficiency= character.proficiencies.get('strength', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if strength_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if strength_proficiency.get('proficiency', False) or strength_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Fuerza (Fue)</td>
                            {% set save_strength = strength_mod %}
                            {% if strength_proficiency.get('proficiency', False) and not strength_proficiency.get('expertise', False) %}
                                {% set save_strength = strength_mod + proficiency_bonus %}
                            {% elif strength_proficiency.get('expertise', False) %}
                                {% set save_strength = strength_mod + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(save_strength) }}</td>
                        </tr>

                        <!-- Destreza -->
                        <tr>
                            <td class="text-center">
                                {% set dexterity_proficiency= character.proficiencies.get('dexterity', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if dexterity_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if dexterity_proficiency.get('proficiency', False) or dexterity_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Destreza (Des)</td>
                            {% set save_dexterity = dexterity_mod %}
                            {% if dexterity_proficiency.get('proficiency', False) and not dexterity_proficiency.get('expertise', False) %}
                                {% set save_dexterity = dexterity_mod + proficiency_bonus %}
                            {% elif dexterity_proficiency.get('expertise', False) %}
                                {% set save_dexterity = dexterity_mod + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(save_dexterity) }}</td>
                        </tr>

                        <!-- Constitución -->
                        <tr>
                            <td class="text-center">
                                {% set constitution_proficiency= character.proficiencies.get('constitution', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if constitution_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if constitution_proficiency.get('proficiency', False) or constitution_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Constitución (Con)</td>
                            {% set save_constitution = constitution_mod %}
                            {% if constitution_proficiency.get('proficiency', False) and not constitution_proficiency.get('expertise', False) %}
                                {% set save_constitution = constitution_mod + proficiency_bonus %}
                            {% elif constitution_proficiency.get('expertise', False) %}
                                {% set save_constitution = constitution_mod + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(save_constitution) }}</td>
                        </tr>

                        <!-- Inteligencia -->
                        <tr>
                            <td class="text-center">
                                {% set intelligence_proficiency= character.proficiencies.get('intelligence', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if intelligence_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if intelligence_proficiency.get('proficiency', False) or intelligence_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Inteligencia (Int)</td>
                            {% set save_intelligence = intelligence_mod %}
                            {% if intelligence_proficiency.get('proficiency', False) and not intelligence_proficiency.get('expertise', False) %}
                                {% set save_intelligence = intelligence_mod + proficiency_bonus %}
                            {% elif intelligence_proficiency.get('expertise', False) %}
                                {% set save_intelligence = intelligence_mod + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(save_intelligence) }}</td>
                        </tr>

                        <!-- Sabiduría -->
                        <tr>
                            <td class="text-center">
                                {% set wisdom_proficiency= character.proficiencies.get('wisdom', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if wisdom_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if wisdom_proficiency.get('proficiency', False) or wisdom_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Sabiduría (Sab)</td>
                            {% set save_wisdom = wisdom_mod %}
                            {% if wisdom_proficiency.get('proficiency', False) and not wisdom_proficiency.get('expertise', False) %}
                                {% set save_wisdom = wisdom_mod + proficiency_bonus %}
                            {% elif wisdom_proficiency.get('expertise', False) %}
                                {% set save_wisdom = wisdom_mod + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(save_wisdom) }}</td>
                        </tr>

                        <!-- Carisma -->
                        <tr>
                            <td class="text-center">
                                {% set charisma_proficiency= character.proficiencies.get('charisma', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if charisma_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if charisma_proficiency.get('proficiency', False) or charisma_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Carisma (Car)</td>
                            {% set save_charisma = charisma_mod %}
                            {% if charisma_proficiency.get('proficiency', False) and not charisma_proficiency.get('expertise', False) %}
                                {% set save_charisma = charisma_mod + proficiency_bonus %}
                            {% elif charisma_proficiency.get('expertise', False) %}
                                {% set save_charisma = charisma_mod + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(save_charisma) }}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        {% include 'characters/edit_modals/saving_throws_modal.html' %}
    </div>

    <!-- Columna derecha - Habilidades -->
    <div class="w-full lg:w-3/5 xl:w-7/12">
        <div class="card bg-base-200 shadow-xl mb-6 relative overflow-visible">
            <button class="btn btn-ghost btn-circle btn-sm absolute -right-2 -top-2 z-10 bg-secondary shadow-md hover:bg-secondary" onclick="edit_skills_modal.showModal()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
            </button>
            <div class="card-body p-4">
                <h2 class="card-title text-xl mb-4">Habilidades</h2>

                <div class="overflow-x-auto">
                    <table class="table table-zebra w-full">
                        <tbody>

                        <tr>
                            <td class="text-center">Competencia</td>
                        </tr>

                        <!-- Acrobacias -->
                        <tr>
                            <td class="text-center">
                                {% set acrobatics_proficiency= character.proficiencies.get('acrobatics', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if acrobatics_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if acrobatics_proficiency.get('proficiency', False) or acrobatics_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Acrobacias (Des)</td>
                            {% set skill_acrobatics = dexterity_mod %}
                            {% if acrobatics_proficiency.get('proficiency', False) and not acrobatics_proficiency.get('expertise', False) %}
                                {% set skill_acrobatics = skill_acrobatics + proficiency_bonus %}
                            {% elif acrobatics_proficiency.get('expertise', False) %}
                                {% set skill_acrobatics = skill_acrobatics + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_acrobatics) }}</td>
                        </tr>

                        <!-- Arcanos -->
                        <tr>
                            <td class="text-center">
                                {% set arcana_proficiency= character.proficiencies.get('arcana', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if arcana_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if arcana_proficiency.get('proficiency', False) or arcana_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Arcanos (Int)</td>
                            {% set skill_arcana = intelligence_mod %}
                            {% if arcana_proficiency.get('proficiency', False) and not arcana_proficiency.get('expertise', False) %}
                                {% set skill_arcana = skill_arcana + proficiency_bonus %}
                            {% elif arcana_proficiency.get('expertise', False) %}
                                {% set skill_arcana = skill_arcana + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_arcana) }}</td>
                        </tr>

                        <!-- Atletismo -->
                        <tr>
                            <td class="text-center">
                                {% set athletics_proficiency= character.proficiencies.get('athletics', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if athletics_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if athletics_proficiency.get('proficiency', False) or athletics_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Atletismo (Fue)</td>
                            {% set skill_athletics = strength_mod %}
                            {% if athletics_proficiency.get('proficiency', False) and not athletics_proficiency.get('expertise', False) %}
                                {% set skill_athletics = skill_athletics + proficiency_bonus %}
                            {% elif athletics_proficiency.get('expertise', False) %}
                                {% set skill_athletics = skill_athletics + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_athletics) }}</td>
                        </tr>

                        <!-- Engañar -->
                        <tr>
                            <td class="text-center">
                                {% set deception_proficiency= character.proficiencies.get('deception', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if deception_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if deception_proficiency.get('proficiency', False) or deception_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Engañar (Car)</td>
                            {% set skill_deception = charisma_mod %}
                            {% if deception_proficiency.get('proficiency', False) and not deception_proficiency.get('expertise', False) %}
                                {% set skill_deception = skill_deception + proficiency_bonus %}
                            {% elif deception_proficiency.get('expertise', False) %}
                                {% set skill_deception = skill_deception + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_deception) }}</td>
                        </tr>

                        <!-- Historia -->
                        <tr>
                            <td class="text-center">
                                {% set history_proficiency= character.proficiencies.get('history', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if history_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if history_proficiency.get('proficiency', False) or history_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Historia (Int)</td>
                            {% set skill_history = intelligence_mod %}
                            {% if history_proficiency.get('proficiency', False) and not history_proficiency.get('expertise', False) %}
                                {% set skill_history = skill_history + proficiency_bonus %}
                            {% elif history_proficiency.get('expertise', False) %}
                                {% set skill_history = skill_history + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_history) }}</td>
                        </tr>

                        <!-- Interpretación -->
                        <tr>
                            <td class="text-center">
                                {% set performance_proficiency= character.proficiencies.get('performance', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if performance_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if performance_proficiency.get('proficiency', False) or performance_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Interpretación (Car)</td>
                            {% set skill_performance = charisma_mod %}
                            {% if performance_proficiency.get('proficiency', False) and not performance_proficiency.get('expertise', False) %}
                                {% set skill_performance = skill_performance + proficiency_bonus %}
                            {% elif performance_proficiency.get('expertise', False) %}
                                {% set skill_performance = skill_performance + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_performance) }}</td>
                        </tr>

                        <!-- Intimidar -->
                        <tr>
                            <td class="text-center">
                                {% set intimidation_proficiency= character.proficiencies.get('intimidation', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if intimidation_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if intimidation_proficiency.get('proficiency', False) or intimidation_proficiency.get('expertise', False) %}ch    ecked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Intimidar (Car)</td>
                            {% set skill_intimidation = charisma_mod %}
                            {% if intimidation_proficiency.get('proficiency', False) and not intimidation_proficiency.get('expertise', False) %}
                                {% set skill_intimidation = skill_intimidation + proficiency_bonus %}
                            {% elif intimidation_proficiency.get('expertise', False) %}
                                {% set skill_intimidation = skill_intimidation + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_intimidation) }}</td>
                        </tr>

                        <!-- Investigación -->
                        <tr>
                            <td class="text-center">
                                {% set investigation_proficiency= character.proficiencies.get('investigation', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if investigation_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if investigation_proficiency.get('proficiency', False) or investigation_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Investigación (Int)</td>
                            {% set skill_investigation = intelligence_mod %}
                            {% if investigation_proficiency.get('proficiency', False) and not investigation_proficiency.get('expertise', False) %}
                                {% set skill_investigation = skill_investigation + proficiency_bonus %}
                            {% elif investigation_proficiency.get('expertise', False) %}
                                {% set skill_investigation = skill_investigation + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_investigation) }}</td>
                        </tr>

                        <!-- Juego de Manos -->
                        <tr>
                            <td class="text-center">
                                {% set sleight_of_hand_proficiency= character.proficiencies.get('sleight_of_hand', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if sleight_of_hand_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if sleight_of_hand_proficiency.get('proficiency', False) or sleight_of_hand_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Juego de Manos (Des)</td>
                            {% set skill_sleight_of_hand = dexterity_mod %}
                            {% if sleight_of_hand_proficiency.get('proficiency', False) and not sleight_of_hand_proficiency.get('expertise', False) %}
                                {% set skill_sleight_of_hand = skill_sleight_of_hand + proficiency_bonus %}
                            {% elif sleight_of_hand_proficiency.get('expertise', False) %}
                                {% set skill_sleight_of_hand = skill_sleight_of_hand + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_sleight_of_hand) }}</td>
                        </tr>

                        <!-- Medicina -->
                        <tr>
                            <td class="text-center">
                                {% set medicine_proficiency= character.proficiencies.get('medicine', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if medicine_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if medicine_proficiency.get('proficiency', False) or medicine_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Medicina (Sab)</td>
                            {% set skill_medicine = wisdom_mod %}
                            {% if medicine_proficiency.get('proficiency', False) and not medicine_proficiency.get('expertise', False) %}
                                {% set skill_medicine = skill_medicine + proficiency_bonus %}
                            {% elif medicine_proficiency.get('expertise', False) %}
                                {% set skill_medicine = skill_medicine + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_medicine) }}</td>
                        </tr>

                        <!-- Naturaleza -->
                        <tr>
                            <td class="text-center">
                                {% set nature_proficiency= character.proficiencies.get('nature', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if nature_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if nature_proficiency.get('proficiency', False) or nature_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Naturaleza (Int)</td>
                            {% set skill_nature = intelligence_mod %}
                            {% if nature_proficiency.get('proficiency', False) and not nature_proficiency.get('expertise', False) %}
                                {% set skill_nature = skill_nature + proficiency_bonus %}
                            {% elif nature_proficiency.get('expertise', False) %}
                                {% set skill_nature = skill_nature + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_nature) }}</td>
                        </tr>

                        <!-- Percepción -->
                        <tr>
                            <td class="text-center">
                                {% set perception_proficiency= character.proficiencies.get('perception', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if perception_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if perception_proficiency.get('proficiency', False) or perception_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Percepción (Sab)</td>
                            {% set skill_perception = wisdom_mod %}
                            {% if perception_proficiency.get('proficiency', False) and not perception_proficiency.get('expertise', False) %}
                                {% set skill_perception = skill_perception + proficiency_bonus %}
                            {% elif perception_proficiency.get('expertise', False) %}
                                {% set skill_perception = skill_perception + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_perception) }}</td>
                        </tr>

                        <!-- Perspicacia -->
                        <tr>
                            <td class="text-center">
                                {% set insight_proficiency= character.proficiencies.get('insight', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if insight_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if insight_proficiency.get('proficiency', False) or insight_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Perspicacia (Sab)</td>
                            {% set skill_insight = wisdom_mod %}
                            {% if insight_proficiency.get('proficiency', False) and not insight_proficiency.get('expertise', False) %}
                                {% set skill_insight = skill_insight + proficiency_bonus %}
                            {% elif insight_proficiency.get('expertise', False) %}
                                {% set skill_insight = skill_insight + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_insight) }}</td>
                        </tr>

                        <!-- Persuasión -->
                        <tr>
                            <td class="text-center">
                                {% set persuasion_proficiency= character.proficiencies.get('persuasion', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if persuasion_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if persuasion_proficiency.get('proficiency', False) or persuasion_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Persuasión (Car)</td>
                            {% set skill_persuasion = charisma_mod %}
                            {% if persuasion_proficiency.get('proficiency', False) and not persuasion_proficiency.get('expertise', False) %}
                                {% set skill_persuasion = skill_persuasion + proficiency_bonus %}
                            {% elif persuasion_proficiency.get('expertise', False) %}
                                {% set skill_persuasion = skill_persuasion + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_persuasion) }}</td>
                        </tr>

                        <!-- Religión -->
                        <tr>
                            <td class="text-center">
                                {% set religion_proficiency= character.proficiencies.get('religion', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if religion_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if religion_proficiency.get('proficiency', False) or religion_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Religión (Int)</td>
                            {% set skill_religion = intelligence_mod %}
                            {% if religion_proficiency.get('proficiency', False) and not religion_proficiency.get('expertise', False) %}
                                {% set skill_religion = skill_religion + proficiency_bonus %}
                            {% elif religion_proficiency.get('expertise', False) %}
                                {% set skill_religion = skill_religion + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_religion) }}</td>
                        </tr>

                        <!-- Sigilo -->
                        <tr>
                            <td class="text-center">
                                {% set stealth_proficiency= character.proficiencies.get('stealth', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if stealth_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if stealth_proficiency.get('proficiency', False) or stealth_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Sigilo (Des)</td>
                            {% set skill_stealth = dexterity_mod %}
                            {% if stealth_proficiency.get('proficiency', False) and not stealth_proficiency.get('expertise', False) %}
                                {% set skill_stealth = skill_stealth + proficiency_bonus %}
                            {% elif stealth_proficiency.get('expertise', False) %}
                                {% set skill_stealth = skill_stealth + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_stealth) }}</td>
                        </tr>

                        <!-- Supervivencia -->
                        <tr>
                            <td class="text-center">
                                {% set survival_proficiency= character.proficiencies.get('survival', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if survival_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if survival_proficiency.get('proficiency', False) or survival_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Supervivencia (Sab)</td>
                            {% set skill_survival = wisdom_mod %}
                            {% if survival_proficiency.get('proficiency', False) and not survival_proficiency.get('expertise', False) %}
                                {% set skill_survival = skill_survival + proficiency_bonus %}
                            {% elif survival_proficiency.get('expertise', False) %}
                                {% set skill_survival = skill_survival + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_survival) }}</td>
                        </tr>

                        <!-- Trato con Animales -->
                        <tr>
                            <td class="text-center">
                                {% set animal_handling_proficiency= character.proficiencies.get('animal_handling', {}) %}
                                <input type="checkbox" class="checkbox checkbox-sm disabled:opacity-70 {% if animal_handling_proficiency.get('expertise', False) %}checkbox-accent{% endif %}"
                                       {% if animal_handling_proficiency.get('proficiency', False) or animal_handling_proficiency.get('expertise', False) %}checked="checked"{% endif %}
                                       disabled/>
                            </td>
                            <td>Trato con Animales (Sab)</td>
                            {% set skill_animal_handling = wisdom_mod %}
                            {% if animal_handling_proficiency.get('proficiency', False) and not animal_handling_proficiency.get('expertise', False) %}
                                {% set skill_animal_handling = skill_animal_handling + proficiency_bonus %}
                            {% elif animal_handling_proficiency.get('expertise', False) %}
                                {% set skill_animal_handling = skill_animal_handling + (2 * proficiency_bonus) %}
                            {% endif %}
                            <td class="text-right">{{ "%+d"|format(skill_animal_handling) }}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    {% include "characters/edit_modals/skills_modal.html" %}
</div>
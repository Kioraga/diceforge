{% extends "base.html" %}

{% block title %}{{ character.name }} - {% endblock %}

{% block content %}
    <div class="flex-auto container mx-auto p-4 max-w-6xl mb-8">
        <!-- Encabezado del personaje con navegación y acciones -->
        <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
            <div class="flex gap-2">
                <a href="{{ url_for('characters.character_gallery') }}" class="btn btn-outline btn-sm gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                         stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Volver
                </a>
            </div>
            <div class="flex gap-2">
                <a href=""
                   class="btn btn-outline btn-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                         stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                    </svg>
                    Editar
                </a>
                <a class="btn btn-outline btn-sm" hidden>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                         stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                    </svg>
                    Compartir
                </a>
                <a href=""
                   class="btn btn-outline btn-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                         stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                    </svg>
                    Imprimir
                </a>
            </div>
        </div>

        <!-- Encabezado del perfil del personaje -->
        <div class="card bg-base-200 shadow-xl mb-6">
            <div class="card-body p-6">
                <div class="flex flex-col md:flex-row gap-6 items-center md:items-start">
                    <!-- Avatar del personaje -->
                    <div class="avatar placeholder">
                        <div class="bg-neutral text-neutral-content rounded-full w-24">
                            <span class="text-3xl flex justify-center h-full items-center">{{ character.name[:2]|upper }}</span>
                        </div>
                    </div>

                    <!-- Información básica del personaje -->
                    <div class="flex-1">
                        <div class="flex flex-col sm:flex-row justify-between items-center sm:items-start gap-4">
                            <div>
                                <h1 class="text-3xl font-bold">{{ character.name }}</h1>
                                <div class="flex flex-wrap gap-2 mt-2">
                                    <span class="badge badge-lg">{{ character.race }}</span>
                                    <span class="badge badge-accent badge-lg">{{ character.char_class }}</span>
                                    <span class="badge badge-secondary badge-lg">Nivel {{ character.level }}</span>
                                </div>
                            </div>

                            <!-- Puntos de Golpe -->
                            <div class="stats bg-base-100 shadow">
                                <div class="stat px-4 py-2">
                                    <div class="stat-title">Puntos de Golpe</div>
                                    <div class="stat-value text-center">{{ character.hp|default(-42) }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pestañas para secciones diferentes -->
        <div class="tabs tabs-lift tabs-sm sm:tabs-md ">
            <input type="radio" name="char_sections" class="tab [--tab-border-color:var(--color-accent)]"
                   aria-label="Información"
                   checked="checked"/>
            <div class="tab-content bg-base-100 border-accent p-6">
                <div class="flex flex-col lg:flex-row gap-6">
                    <!-- Columna izquierda - Características -->
                    <div class="w-full lg:w-2/5 xl:w-5/12">
                        <!-- Tarjeta de Características -->
                        <div class="card bg-base-200 shadow-xl mb-6">
                            <div class="card-body p-4">
                                <h2 class="card-title text-xl mb-4">Características</h2>

                                <div class="grid grid-cols-3 gap-4">
                                    <!-- FUE -->
                                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                                        <div class="stat-title text-xs">FUE</div>
                                        <div class="stat-value text-2xl">{{ character.ability_scores.get('strength', 0) }}</div>
                                        <div class="flex justify-center w-full">
                                            <div class="badge badge-accent mt-1">
                                                {% set strength_mod = character.ability_modifiers.get('strength', 0) %}
                                                {{ "%+d"|format(strength_mod) }}
                                            </div>
                                        </div>
                                    </div>

                                    <!-- DES -->
                                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                                        <div class="stat-title text-xs">DES</div>
                                        <div class="stat-value text-2xl">{{ character.ability_scores.get('dexterity', 0) }}</div>
                                        <div class="flex justify-center w-full">
                                            <div class="badge badge-accent mt-1">
                                                {% set dexterity_mod = character.ability_modifiers.get('dexterity', 0) %}
                                                {{ "%+d"|format(dexterity_mod) }}
                                            </div>
                                        </div>
                                    </div>

                                    <!-- CON -->
                                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                                        <div class="stat-title text-xs">CON</div>
                                        <div class="stat-value text-2xl">{{ character.ability_scores.get('constitution', 0) }}</div>
                                        <div class="flex justify-center w-full">
                                            <div class="badge badge-accent mt-1">
                                                {% set constitution_mod = character.ability_modifiers.get('constitution', 0) %}
                                                {{ "%+d"|format(constitution_mod) }}
                                            </div>
                                        </div>
                                    </div>

                                    <!-- INT -->
                                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                                        <div class="stat-title text-xs">INT</div>
                                        <div class="stat-value text-2xl">{{ character.ability_scores.get('intelligence', 0) }}</div>
                                        <div class="flex justify-center w-full">
                                            <div class="badge badge-accent mt-1">
                                                {% set intelligence_mod = character.ability_modifiers.get('intelligence', 0) %}
                                                {{ "%+d"|format(intelligence_mod) }}
                                            </div>
                                        </div>
                                    </div>

                                    <!-- SAB -->
                                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                                        <div class="stat-title text-xs">SAB</div>
                                        <div class="stat-value text-2xl">{{ character.ability_scores.get('wisdom', 0) }}</div>
                                        <div class="flex justify-center w-full">
                                            <div class="badge badge-accent mt-1">
                                                {% set wisdom_mod = character.ability_modifiers.get('wisdom', 0) %}
                                                {{ "%+d"|format(wisdom_mod) }}
                                            </div>
                                        </div>
                                    </div>

                                    <!-- CAR -->
                                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                                        <div class="stat-title text-xs">CAR</div>
                                        <div class="stat-value text-2xl">{{ character.ability_scores.get('charisma', 0) }}</div>
                                        <div class="flex justify-center w-full">
                                            <div class="badge badge-accent mt-1">
                                                {% set charisma_mod = character.ability_modifiers.get('charisma', 0) %}
                                                {{ "%+d"|format(charisma_mod) }}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Stats adicionales -->
                                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mt-4">
                                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                                        <div class="stat-title text-xs">Iniciativa</div>
                                        <div class="stat-value text-xl">{{ "%+d"|format(dexterity_mod) }}</div>
                                    </div>

                                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                                        <div class="stat-title text-xs">Velocidad</div>
                                        <div class="stat-value text-xl">{{ character.speed|default(42) }}</div>
                                        <div class="text-xs">pies</div>
                                    </div>

                                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                                        <div class="stat-title text-xs">Clase de</div>
                                        <div class="stat-value text-xl">{{ character.armor_class|default(42) }}</div>
                                        <div class="stat-title text-xs">armadura</div>
                                    </div>

                                    <div class="stat bg-base-100 rounded-box p-2 text-center">
                                        <div class="stat-title text-xs">Bonif. de</div>
                                        <div class="stat-value text-xl">
                                            {% set level = character.level|default(1) %}
                                            {% set proficiency_bonus = ((level - 1) // 4) + 2 %}
                                            +{{ proficiency_bonus }}
                                        </div>
                                        <div class="stat-title text-xs">competencia</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tiradas de Salvación -->
                        <div class="card bg-base-200 shadow-xl mb-6">
                            <div class="card-body p-4">
                                <h2 class="card-title text-xl mb-4">Tiradas de Salvación</h2>

                                <div class="overflow-x-auto">
                                    <table class="table table-zebra w-full">
                                        <tbody>

                                        <tr>
                                            <td class="text-center">Competencia</td>
                                        </tr>

                                        <!-- Fuerza -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.save_strength %}checked{% endif %}/>
                                            </td>
                                            <td>Fuerza (Fue)</td>
                                            {% set save_strength = strength_mod %}
                                            <td class="text-right">{{ "%+d"|format(save_strength) }}</td>
                                        </tr>

                                        <!-- Destreza -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.save_dexterity %}checked{% endif %}/>
                                            </td>
                                            <td>Destreza (Des)</td>
                                            {% set save_dexterity = dexterity_mod %}
                                            <td class="text-right">{{ "%+d"|format(save_dexterity) }}</td>
                                        </tr>

                                        <!-- Constitución -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.save_constitution %}checked{% endif %}/>
                                            </td>
                                            <td>Constitución (Con)</td>
                                            {% set save_constitution = constitution_mod %}
                                            <td class="text-right">{{ "%+d"|format(save_constitution) }}</td>
                                        </tr>

                                        <!-- Inteligencia -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.save_intelligence %}checked{% endif %}/>
                                            </td>
                                            <td>Inteligencia (Int)</td>
                                            {% set save_intelligence = intelligence_mod %}
                                            <td class="text-right">{{ "%+d"|format(save_intelligence) }}</td>
                                        </tr>

                                        <!-- Sabiduría -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.save_wisdom %}checked{% endif %}/>
                                            </td>
                                            <td>Sabiduría (Sab)</td>
                                            {% set save_wisdom = wisdom_mod %}
                                            <td class="text-right">{{ "%+d"|format(save_wisdom) }}</td>
                                        </tr>

                                        <!-- Carisma -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.save_charisma %}checked{% endif %}/>
                                            </td>
                                            <td>Carisma (Car)</td>
                                            {% set save_charisma = charisma_mod %}
                                            <td class="text-right">{{ "%+d"|format(save_charisma) }}</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Ataques -->
                        <div class="card bg-base-200 shadow-xl mb-6 hidden">
                            <div class="card-body p-4">
                                <h2 class="card-title text-xl mb-4">Ataques</h2>
                                <p class="text-sm text-base-content/70 mb-4">Añade armas a tu personaje para ver en esta
                                    sección
                                    el resumen de tus ataques</p>

                                {% if character.weapons %}
                                    <div class="overflow-x-auto">
                                        <table class="table table-zebra w-full">
                                            <thead>
                                            <tr>
                                                <th>Nombre</th>
                                                <th>Ataque</th>
                                                <th>Daño</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for weapon in character.weapons %}
                                                <tr>
                                                    <td>{{ weapon.name }}</td>
                                                    <td>+{{ weapon.attack_bonus }}</td>
                                                    <td>{{ weapon.damage }}</td>
                                                </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                {% else %}
                                    <div class="alert alert-info">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                             class="stroke-current shrink-0 w-6 h-6">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                  d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        <span>No hay armas añadidas a este personaje.</span>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Columna derecha - Habilidades -->
                    <div class="w-full lg:w-3/5 xl:w-7/12">
                        <div class="card bg-base-200 shadow-xl mb-6">
                            <div class="card-body p-4">
                                <h2 class="card-title text-xl mb-4">Habilidades</h2>

                                <div class="overflow-x-auto">
                                    <table class="table table-zebra w-full">
                                        <tbody>

                                        <tr>
                                            <td class="text-center">Competencia</td>
                                        </tr>

                                        <!-- Acrobacias -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.skill_acrobatics %}checked{% endif %}/>
                                            </td>
                                            <td>Acrobacias (Des)</td>
                                            {% set skill_acrobatics = dexterity_mod %}
                                            <td class="text-right">{{ "%+d"|format(skill_acrobatics) }}</td>
                                        </tr>

                                        <!-- Arcanos -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.skill_arcana %}checked{% endif %}/>
                                            </td>
                                            <td>Arcanos (Int)</td>
                                            {% set skill_arcana = intelligence_mod %}
                                            <td class="text-right">{{ "%+d"|format(skill_arcana) }}</td>
                                        </tr>

                                        <!-- Atletismo -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.skill_athletics %}checked{% endif %}/>
                                            </td>
                                            <td>Atletismo (Fue)</td>
                                            {% set skill_athletics = strength_mod %}
                                            <td class="text-right">{{ "%+d"|format(skill_athletics) }}</td>
                                        </tr>

                                        <!-- Engañar -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.skill_deception %}checked{% endif %}/>
                                            </td>
                                            <td>Engañar (Car)</td>
                                            {% set skill_deception = charisma_mod %}
                                            <td class="text-right">{{ "%+d"|format(skill_deception) }}</td>
                                        </tr>

                                        <!-- Historia -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.skill_history %}checked{% endif %}/>
                                            </td>
                                            <td>Historia (Int)</td>
                                            {% set skill_history = intelligence_mod %}
                                            <td class="text-right">{{ "%+d"|format(skill_history) }}</td>
                                        </tr>

                                        <!-- Interpretación -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.skill_performance %}checked{% endif %}/>
                                            </td>
                                            <td>Interpretación (Car)</td>
                                            {% set skill_performance = charisma_mod %}
                                            <td class="text-right">{{ "%+d"|format(skill_performance) }}</td>
                                        </tr>

                                        <!-- Intimidar -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.skill_intimidation %}checked{% endif %}/>
                                            </td>
                                            <td>Intimidar (Car)</td>
                                            {% set skill_intimidation = charisma_mod %}
                                            <td class="text-right">{{ "%+d"|format(skill_intimidation) }}</td>
                                        </tr>

                                        <!-- Investigación -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.skill_investigation %}checked{% endif %}/>
                                            </td>
                                            <td>Investigación (Int)</td>
                                            {% set skill_investigation = intelligence_mod %}
                                            <td class="text-right">{{ "%+d"|format(skill_investigation) }}</td>
                                        </tr>

                                        <!-- Juego de Manos -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.skill_sleight_of_hand %}checked{% endif %}/>
                                            </td>
                                            <td>Juego de Manos (Des)</td>
                                            {% set skill_sleight_of_hand = dexterity_mod %}
                                            <td class="text-right">{{ "%+d"|format(skill_sleight_of_hand) }}</td>
                                        </tr>

                                        <!-- Medicina -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.skill_medicine %}checked{% endif %}/>
                                            </td>
                                            <td>Medicina (Sab)</td>
                                            {% set skill_medicine = wisdom_mod %}
                                            <td class="text-right">{{ "%+d"|format(skill_medicine) }}</td>
                                        </tr>

                                        <!-- Naturaleza -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.skill_nature %}checked{% endif %}/>
                                            </td>
                                            <td>Naturaleza (Int)</td>
                                            {% set skill_nature = intelligence_mod %}
                                            <td class="text-right">{{ "%+d"|format(skill_nature) }}</td>
                                        </tr>

                                        <!-- Percepción -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.skill_perception %}checked{% endif %}/>
                                            </td>
                                            <td>Percepción (Sab)</td>
                                            {% set skill_perception = wisdom_mod %}
                                            <td class="text-right">{{ "%+d"|format(skill_perception) }}</td>
                                        </tr>

                                        <!-- Perspicacia -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.skill_insight %}checked{% endif %}/>
                                            </td>
                                            <td>Perspicacia (Sab)</td>
                                            {% set skill_insight = wisdom_mod %}
                                            <td class="text-right">{{ "%+d"|format(skill_insight) }}</td>
                                        </tr>

                                        <!-- Persuasión -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.skill_persuasion %}checked{% endif %}/>
                                            </td>
                                            <td>Persuasión (Car)</td>
                                            {% set skill_persuasion = charisma_mod %}
                                            <td class="text-right">{{ "%+d"|format(skill_persuasion) }}</td>
                                        </tr>

                                        <!-- Religión -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.skill_religion %}checked{% endif %}/>
                                            </td>
                                            <td>Religión (Int)</td>
                                            {% set skill_religion = intelligence_mod %}
                                            <td class="text-right">{{ "%+d"|format(skill_religion) }}</td>
                                        </tr>

                                        <!-- Sigilo -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.skill_stealth %}checked{% endif %}/>
                                            </td>
                                            <td>Sigilo (Des)</td>
                                            {% set skill_stealth = dexterity_mod %}
                                            <td class="text-right">{{ "%+d"|format(skill_stealth) }}</td>
                                        </tr>

                                        <!-- Supervivencia -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.skill_survival %}checked{% endif %}/>
                                            </td>
                                            <td>Supervivencia (Sab)</td>
                                            {% set skill_survival = wisdom_mod %}
                                            <td class="text-right">{{ "%+d"|format(skill_survival) }}</td>
                                        </tr>

                                        <!-- Trato con Animales -->
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" class="checkbox checkbox-sm"
                                                       {% if character.skill_animal_handling %}checked{% endif %}/>
                                            </td>
                                            <td>Trato con Animales (Sab)</td>
                                            {% set skill_animal_handling = wisdom_mod %}
                                            <td class="text-right">{{ "%+d"|format(skill_animal_handling) }}</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Otras Competencias -->
                        <div class="card bg-base-200 shadow-xl mb-6">
                            <div class="card-body p-4">
                                <h2 class="card-title text-xl mb-4">Otras Competencias</h2>

                                <div class="mb-4">
                                    <p class="font-medium mb-2">Dispones de las siguientes competencias adicionales:</p>
                                    <ul class="list-disc list-inside space-y-1 pl-4">
                                        <li>Ballesta ligera, Bastón, Daga, Dardo y Honda</li>
                                        {% for competency in character.other_competencies %}
                                            <li>{{ competency }}</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <input type="radio" name="char_sections" class="tab [--tab-border-color:var(--color-accent)]"
                   aria-label="Rasgos"/>
            <div class="tab-content bg-base-100 border-accent p-6">Tab content 2</div>

            <input type="radio" name="char_sections" class="tab [--tab-border-color:var(--color-accent)]"
                   aria-label="Conjuros"/>
            <div class="tab-content bg-base-100 border-accent p-6">Tab content 3</div>

            <input type="radio" name="char_sections" class="tab [--tab-border-color:var(--color-accent)]"
                   aria-label="Trasfondo"/>
            <div class="tab-content bg-base-100 border-accent p-6">Tab content 3</div>
        </div>
    </div>


{% endblock %}